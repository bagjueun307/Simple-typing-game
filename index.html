<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2팀 실시간 타자 게임</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root {
            --red-team: #ff4d4d;
            --blue-team: #4d94ff;
            --bg-dark: #1a1a1a;
        }

        body { 
            margin: 0; 
            background: var(--bg-dark); 
            color: white; 
            font-family: 'Pretendard', sans-serif; 
            overflow: hidden; 
            transition: background-color 0.5s ease; /* 배경색 전환 애니메이션 */
        }

        /* 현재 턴에 따른 전체 배경색 강조 (약하게) */
        body.turn-1 { background-color: #2c1a1a; }
        body.turn-2 { background-color: #1a1e2c; }

        #top-bar { 
            height: 80px; 
            display: flex; 
            justify-content: space-around; 
            align-items: center; 
            background: rgba(0,0,0,0.5); 
            backdrop-filter: blur(10px);
            border-bottom: 2px solid rgba(255,255,255,0.1);
        }

        .timer-display { font-size: 2.5rem; font-weight: 900; color: #fff; }
        .team-badge { padding: 10px 25px; border-radius: 30px; font-weight: bold; font-size: 1.4rem; color: white; transition: 0.3s; }
        .badge-1 { background-color: var(--red-team); box-shadow: 0 0 15px var(--red-team); }
        .badge-2 { background-color: var(--blue-team); box-shadow: 0 0 15px var(--blue-team); }

        #game-container { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            grid-template-rows: 1fr 1fr; 
            height: calc(100vh - 180px); 
            gap: 20px; 
            padding: 20px; 
            position: relative; 
        }

        .monitor { 
            background: #252525; 
            border: 6px solid #444; 
            border-radius: 15px; 
            display: flex; 
            flex-direction: column; 
            cursor: pointer; 
            position: relative; 
            overflow: hidden; 
            transition: 0.3s; 
        }

        /* 턴인 팀의 모니터 테두리 강조 */
        .monitor.active-1 { border-color: var(--red-team); box-shadow: 0 0 30px rgba(255, 77, 77, 0.4); }
        .monitor.active-2 { border-color: var(--blue-team); box-shadow: 0 0 30px rgba(77, 148, 255, 0.4); }

        .monitor.expanded { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 100; background: var(--bg-dark); }

        /* 4x4 정사각형 그리드 */
        .grid { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 10px; 
            padding: 15px; 
            aspect-ratio: 1 / 1; /* 그리드 전체를 정사각형으로 유지 */
            margin: auto;
            max-height: 90%;
        }

        .cell { 
            background: #3d3d3d; 
            border-radius: 8px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: bold; 
            font-size: 1rem; 
            aspect-ratio: 1 / 1; /* 각 칸을 정사각형으로 만듦 */
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-align: center;
            box-shadow: inset 0 -4px 0 rgba(0,0,0,0.2);
        }

        /* 팀별 점유 색상 */
        .t1 { background-color: var(--red-team) !important; color: white !important; transform: scale(1.05); }
        .t2 { background-color: var(--blue-team) !important; color: white !important; transform: scale(1.05); }

        #input-area { height: 100px; display: flex; justify-content: center; align-items: center; background: rgba(0,0,0,0.3); }
        #word-input { 
            width: 450px; 
            padding: 18px; 
            font-size: 1.8rem; 
            border-radius: 15px; 
            border: 3px solid #444; 
            background: #000; 
            color: #fff; 
            text-align: center; 
            outline: none; 
            transition: 0.3s;
        }
        /* 입력창 테두리도 턴에 맞춰 변경 */
        .input-1 { border-color: var(--red-team) !important; }
        .input-2 { border-color: var(--blue-team) !important; }
    </style>
</head>
<body>

<div id="top-bar">
    <div><span id="team-ui" class="team-badge">연결 중...</span></div>
    <div class="timer-display" id="timer">--</div>
    <div id="score" style="font-size: 1.5rem; font-weight: bold;">
        <span style="color:var(--red-team)">RED: <span id="s1">0</span></span> | 
        <span style="color:var(--blue-team)">BLUE: <span id="s2">0</span></span>
    </div>
</div>

<div id="game-container">
    <div class="monitor" id="m1" onclick="toggleExpand('m1')"><div class="grid" id="grid1"></div></div>
    <div class="monitor" id="m2" onclick="toggleExpand('m2')"><div class="grid" id="grid2"></div></div>
    <div class="monitor" id="m3" onclick="toggleExpand('m3')"><div class="grid" id="grid3"></div></div>
    <div class="monitor" id="m4" onclick="toggleExpand('m4')"><div class="grid" id="grid4"></div></div>
</div>

<div id="input-area">
    <input type="text" id="word-input" placeholder="차례인 팀이 입력하세요!" autocomplete="off">
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAeR0VBUUJp2iQyXw0jBtz3kf2KuQwpPEQ",
        authDomain: "simple-typing-game-cfe6f.firebaseapp.com",
        databaseURL: "https://simple-typing-game-cfe6f-default-rtdb.firebaseio.com",
        projectId: "simple-typing-game-cfe6f",
        storageBucket: "simple-typing-game-cfe6f.firebasestorage.app",
        messagingSenderId: "930923605778",
        appId: "1:930923605778:web:80cbe48118055a95134dcb",
        measurementId: "G-181REZBN5J"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const masterWords = ["사과", "바나나", "포도", "수박", "기차", "하늘", "바다", "농구", "축구", "컴퓨터", "우주", "별빛", "태양", "구름", "노래", "피아노"];
    let expandedId = null;
    let localCurrentTeam = 1;

    // 1. 초기 데이터 생성 (2팀 체제)
    db.ref('game').once('value', (snap) => {
        if (!snap.exists()) {
            let initialBoard = {}; masterWords.forEach(w => initialBoard[w] = 0);
            db.ref('game').set({
                status: { currentTeam: 1, timeLeft: 10 },
                board: initialBoard
            });
        }
    });

    // 2. 실시간 동기화 및 배경색 처리
    db.ref('game').on('value', (snapshot) => {
        const data = snapshot.val();
        if (!data) return;

        localCurrentTeam = data.status.currentTeam;
        document.getElementById('timer').innerText = data.status.timeLeft;
        
        // UI & 배경색 업데이트
        const ui = document.getElementById('team-ui');
        ui.innerText = localCurrentTeam === 1 ? "RED TEAM TURN" : "BLUE TEAM TURN";
        ui.className = `team-badge badge-${localCurrentTeam}`;
        
        document.body.className = `turn-${localCurrentTeam}`;
        document.getElementById('word-input').className = `input-${localCurrentTeam}`;

        // 모니터 활성화 효과
        document.querySelectorAll('.monitor').forEach(m => {
            m.classList.remove('active-1', 'active-2');
            m.classList.add(`active-${localCurrentTeam}`);
        });

        // 그리드 렌더링 및 점수
        const scores = {1:0, 2:0};
        for (let m = 1; m <= 4; m++) {
            const grid = document.getElementById(`grid${m}`);
            grid.innerHTML = '';
            masterWords.forEach(word => {
                const owner = data.board[word];
                const cell = document.createElement('div');
                cell.className = 'cell' + (owner > 0 ? ` t${owner}` : '');
                cell.innerText = word;
                grid.appendChild(cell);
                if (m === 1 && owner > 0) scores[owner]++;
            });
        }
        document.getElementById('s1').innerText = scores[1];
        document.getElementById('s2').innerText = scores[2];
    });

    // 3. 단어 입력
    document.getElementById('word-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            const val = e.target.value.trim();
            if (masterWords.includes(val)) {
                db.ref(`game/board/${val}`).set(localCurrentTeam);
            }
            e.target.value = '';
        }
    });

    // 4. 2팀 전용 타이머 (1 -> 2 -> 1 무한 반복)
    setInterval(() => {
        db.ref('game/status').transaction((current) => {
            if (current) {
                if (current.timeLeft <= 1) {
                    current.timeLeft = 10;
                    current.currentTeam = current.currentTeam === 1 ? 2 : 1;
                } else {
                    current.timeLeft--;
                }
            }
            return current;
        });
    }, 1000);

    function toggleExpand(id) {
        const el = document.getElementById(id);
        if (expandedId === id) { el.classList.remove('expanded'); expandedId = null; }
        else {
            if (expandedId) document.getElementById(expandedId).classList.remove('expanded');
            el.classList.add('expanded'); expandedId = id;
        }
    }
</script>
</body>
</html>
